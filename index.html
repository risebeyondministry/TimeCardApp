<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RiseBeyond Time Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
  h2 { margin-top: 25px; }
  label { display: block; margin-top: 10px; }
  input, button { margin-top: 5px; padding: 8px; border-radius: 4px; border: none; }
  button { cursor: pointer; }
  .work-section { background: #0074D9; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
  .work-section button { background: #005fa3; color: white; margin-right: 5px; }
  .lunch-section { background: #FF851B; color: white; padding: 15px; border-radius: 8px; }
  .lunch-section button { background: #cc6a15; color: white; margin-right: 5px; }
  .progress-container { background: #fff; border-radius: 6px; overflow: hidden; margin-top: 10px; height: 20px; }
  .progress-bar { height: 100%; width: 0%; transition: width 1s linear, background-color 0.5s ease; }
  .time-card { background: #e6e6e6; padding: 15px; border-radius: 8px; }
  @media (max-width: 600px) {
    body { margin: 10px; font-size: 14px; }
    input, button { width: 100%; margin-top: 8px; }
    .work-section, .lunch-section, .time-card { padding: 10px; }
  }
</style>
</head>
<body>
// --- Lunch Timer ---
function startLunch() {
  const durationMinutes = parseInt(document.getElementById("lunchDuration").value);
  lunchDurationMs = durationMinutes * 60000;
  if (!lunchInterval) {
    lunchEndTime = Date.now() + lunchDurationMs;
    lunchInterval = setInterval(updateLunch, 1000);
    document.getElementById("progressBar").style.backgroundColor = "green";
    updateLunch();
  }
}
function pauseLunch() { clearInterval(lunchInterval); lunchInterval = null; }
function resetLunch() {
  pauseLunch();
  const durationMinutes = parseInt(document.getElementById("lunchDuration").value);
  lunchDurationMs = durationMinutes * 60000;
  document.getElementById("lunchRemaining").textContent = formatTime(lunchDurationMs);
  document.getElementById("progressBar").style.width = "0%";
  document.getElementById("progressBar").style.backgroundColor = "green";
}
function updateLunch() {
  const remaining = lunchEndTime - Date.now();
  if (remaining <= 0) {
    resetLunch();
    document.getElementById("ping").play();
    alert("Lunch time is up! Ping sound played.");
  } else {
    document.getElementById("lunchRemaining").textContent = formatTime(remaining);
    const percent = (remaining / lunchDurationMs) * 100;
    document.getElementById("progressBar").style.width = percent + "%";
    if (percent > 50) {
      document.getElementById("progressBar").style.backgroundColor = "green";
    } else if (percent > 20) {
      document.getElementById("progressBar").style.backgroundColor = "yellow";
    } else {
      document.getElementById("progressBar").style.backgroundColor = "red";
    }
  }
}

// --- Helpers ---
function formatTime(ms) {
  const totalSeconds = Math.floor(ms / 1000);
  const hrs = Math.floor(totalSeconds / 3600);
  const mins = Math.floor((totalSeconds % 3600) / 60);
  const secs = totalSeconds % 60;
  return `${hrs}:${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
}

function calculateHours() {
  const arrival = document.getElementById("arrival").value;
  const lunchStart = document.getElementById("lunchStart").value;
  const lunchEnd = document.getElementById("lunchEnd").value;
  const home = document.getElementById("home").value;

  if (arrival && home) {
    const [arrH, arrM] = arrival.split(":").map(Number);
    const [homH, homM] = home.split(":").map(Number);
    const arr = new Date(); arr.setHours(arrH, arrM, 0, 0);
    const hom = new Date(); hom.setHours(homH, homM, 0, 0);

    let totalHours = (hom - arr) / (1000 * 60 * 60);
    let lunchHours = 0;

    if (lunchStart && lunchEnd) {
      const [lsH, lsM] = lunchStart.split(":").map(Number);
      const [leH, leM] = lunchEnd.split(":").map(Number);
      const lStart = new Date(); lStart.setHours(lsH, lsM, 0, 0);
      const lEnd = new Date(); lEnd.setHours(leH, leM, 0, 0);
      lunchHours = (lEnd - lStart) / (1000 * 60 * 60);
      if (lunchHours < 0) lunchHours = 0;
      totalHours -= lunchHours;
    }

    if (totalHours < 0) totalHours = 0;

    document.getElementById("total").textContent = totalHours.toFixed(2);
    document.getElementById("lunchTotal").textContent = lunchHours.toFixed(2);
  }
}

// --- Initialization ---
window.addEventListener('load', () => {
  const durationMinutes = parseInt(document.getElementById("lunchDuration").value);
  document.getElementById("lunchRemaining").textContent = formatTime(durationMinutes * 60000);
});

document.getElementById("lunchDuration").addEventListener('input', () => {
  if (!lunchInterval) {
    const durationMinutes = parseInt(document.getElementById("lunchDuration").value);
    document.getElementById("lunchRemaining").textContent = formatTime(durationMinutes * 60000);
    document.getElementById("progressBar").style.width = "0%";
    document.getElementById("progressBar").style.backgroundColor = "green";
  }
});
</script>
</body>
</html>
